kind: Build
name: test-client
type: container

dependencies:
  - run.read-registry-prefix

source:
  path: ../..  # Set build context to repository root

include:
  - Cargo.toml
  - lib/kels/**/*
  - lib/kels-derive/**/*
  - clients/kels-bench/**/*
  - clients/kels-cli/**/*
  - clients/test/**/*

spec:
  dockerfile: clients/test/Dockerfile
  buildArgs:
    REGISTRY_PREFIX: ${actions.run.read-registry-prefix.outputs.log}

---

kind: Deploy
name: test-client
type: kubernetes

# Only deploy test-client in node-a environment
disabled: ${environment.name != "node-a"}

dependencies:
  - build.test-client
  - deploy.kels

spec:
  manifestTemplates:
    - manifests.yml.tpl
